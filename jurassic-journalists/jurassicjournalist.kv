#:import F kivy.factory.Factory
#:import Letter classes.Letter
<TypeWriterButton@Button>:
	width: self.parent.width * 1/20
	height: self.parent.height * 1/20
    size_hint: None, None
	background_color: 0,0,0,1
	text_color: 0,0,0,0
    on_release: self.parent.typw.text += self.txt
	canvas.before:
	    Color:
		    rgba: (0,0,0,0) if self.state == 'normal' else (0,.7,.7,.1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: 5,

<PhoneButtons@Label>
    width: self.parent.width * 1/5
	height: self.parent.height * 1/10
    size_hint: None, None
		
<RoomScreen>:
    name: 'RoomScreen'
    canvas:
        Rectangle:
            pos: self.pos
			size: self.size
            source: 'room.png'
    Button:
		on_release: root.manager.current = 'PhoneScreen'
		pos_hint : {'x': .9, 'y': .9}
		size_hint: None, None
		background_color: 0,0,0,.2
	Button:
	    size_hint: None, None
	    pos_hint: {'x': .7, 'y': .45}
	    background_normal: 'typewriter.png'
	    background_down: 'typewriter.png'
	    on_release: F.TypeW().open()


<MainScreen@ScreenManager>:
    RoomScreen
	PhoneScreen


<TextPaper@Image>

<PhoneScreen>:
    name: 'PhoneScreen'
	typw2: typw2
	Button:
		pos_hint : {'x': 0, 'y': 0}
		size_hint: None, None
		background_color: 0,0,0,.2
		on_release: root.manager.current = 'RoomScreen'
	TextInput: #CodeInput
		id: typw2
		background_color: .95,.93,.8,.8 # 0,0,0,0
		padding: 12,12,12,12
		font_name: '1942.ttf'
		pos_hint: {'x': 0.2, 'y':.5}
		size_hint: .6, .5
		readonly: True
		cursor_blink: False
		cursor_color: 0,0,0,1
		cursor_width: 10
		text: ''
	PhoneButtons:
		text: ''
		pos_hint: {'x': .2, 'y':.3}
		disabled: True
	PhoneButtons:
		text: 'abc'
		pos_hint: {'x': .4, 'y':.3}
	PhoneButtons:
		text: 'def'
		pos_hint: {'x': .6, 'y':.3}
	PhoneButtons:
		text: 'ghi'
		pos_hint: {'x': .2, 'y':.2}
	PhoneButtons:
		text: 'jkl'
		pos_hint: {'x': .4, 'y':.2}
	PhoneButtons:
		text: 'mno'
		pos_hint: {'x': .6, 'y':.2}
	PhoneButtons:
		text: 'pqrs'
		pos_hint: {'x': .2, 'y':.1}
	PhoneButtons:
		text: 'tuv'
		pos_hint: {'x': .4, 'y':.1}
	PhoneButtons:
		text: 'wxyz'
		pos_hint: {'x': .6, 'y':.1}
	PhoneButtons:
		text: ''
		pos_hint: {'x': .2, 'y':0}
		disabled: True
	PhoneButtons:
		text: '+'
		pos_hint: {'x': .4, 'y':0}
	PhoneButtons:
		text: ''
		pos_hint: {'x': .6, 'y':0}
	    disabled: True


<TypeW@Popup>
    canvas.before:
        Color:
            rgba: 0,0,0,0
        Rectangle:
            pos: self.pos
            size: self.size
    canvas.after:    
        Color:
            rgba: 1,1,1,.5
        Rectangle:
            pos: self.pos
            size: self.size
            source: 'typewriter.png'
    title: ''
    separator_color: 0,0,0,0
	FloatLayout:
		typw: typw
		GestureSurface:
			on_gesture_complete: typw.text += '_b'
		TextPaper:
			id: typw
			source: 'paper.jpg'
			#pos_hint: {'x': 0.2, 'y':.5}
            pos: self.pos
            size: self.size
			#size_hint: .7, .5
			allow_stretch: True
			letters: []
			text: ''
			on_text: 
			    self.letters.append(Letter(self.text[-1], 32, '1942.ttf')) if '_' not in self.text[-2:] else self.escaped()
			on_letters: self.update()
		TypeWriterButton:
			txt: 'q'
			pos_hint: {'x': .16, 'y':.175}
		TypeWriterButton:
			txt: 'w'
			pos_hint: {'x': .235, 'y':.175}
		TypeWriterButton:
			txt: 'e'
			pos_hint: {'x': .31, 'y':.175}
		TypeWriterButton:
			txt: 'r'
			pos_hint: {'x': .385, 'y':.175}
		TypeWriterButton:
			txt: 't'
			pos_hint: {'x': .46, 'y':.175}
		TypeWriterButton:
			txt: 'y'
			pos_hint: {'x': .535, 'y':.175}
		TypeWriterButton:
			txt: 'u'
			pos_hint: {'x': .61, 'y':.175}
		TypeWriterButton:
			txt: 'i'
			pos_hint: {'x': .685, 'y':.175}
		TypeWriterButton:
			txt: 'o'
			pos_hint: {'x': .76, 'y':.175}
		TypeWriterButton:
			txt: 'p'
			pos_hint: {'x': .835, 'y':.175}
		TypeWriterButton:
			txt: 'a'
			pos_hint: {'x': .2, 'y':.125}
		TypeWriterButton:
			txt: 's'
			pos_hint: {'x': .275, 'y':.125}
		TypeWriterButton:
			txt: 'd'
			pos_hint: {'x': .35, 'y':.125}
		TypeWriterButton
			txt: 'f'
			pos_hint: {'x': .425, 'y':.125}
		TypeWriterButton
			txt: 'g'
			pos_hint: {'x': .5, 'y':.125}
		TypeWriterButton:
			txt: 'h'
			pos_hint: {'x': .575, 'y':.125}
		TypeWriterButton:
			txt: 'j'
			pos_hint: {'x': .65, 'y':.125}
		TypeWriterButton:
			txt: 'k'
			pos_hint: {'x': .725, 'y':.125}
		TypeWriterButton:
			txt: 'l'
			pos_hint: {'x': .8, 'y':.125}
		TypeWriterButton:
			txt: 'z'
			pos_hint: {'x': .2, 'y':.08}
		TypeWriterButton:
			txt: 'x'
			pos_hint: {'x': .275, 'y':.08}
		TypeWriterButton:
			txt: 'c'
			pos_hint: {'x': .35, 'y':.08}
		TypeWriterButton:
			txt: 'v'
			pos_hint: {'x': .425, 'y':.08}
		TypeWriterButton:
			txt: 'b'
			pos_hint: {'x': .5, 'y':.08}
		TypeWriterButton:
			txt: 'n'
			pos_hint: {'x': .575, 'y':.08}
		TypeWriterButton:
			txt: 'm'
			pos_hint: {'x': .65, 'y':.08}
		TypeWriterButton:
			txt: ';'
			pos_hint: {'x': .725, 'y':.08}
		TypeWriterButton:
			txt: ':'
			pos_hint: {'x': .8, 'y':.08}
		TypeWriterButton:
			pos_hint: {'x': .2, 'y':0}
			size_hint: .65, None
	    	height: self.parent.height * 1/20
			txt: ' '
		TypeWriterButton:
		    pos_hint: {'x': .85, 'y': .4}
			size_hint: .15, .15
			txt: '_n'
